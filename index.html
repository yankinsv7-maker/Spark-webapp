<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #0c0c0e; --card: #1c1c1e; --accent: #007aff; --success: #34c759; --text: #fff; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .screen { display: none; width: 100%; max-width: 400px; }
        .active { display: block !important; }
        h2 { text-align: center; margin-bottom: 20px; font-size: 22px; font-weight: 800; }
        
        .selector { display: flex; gap: 10px; margin-bottom: 20px; width: 100%; }
        .type-card { flex: 1; background: var(--card); padding: 15px; border-radius: 12px; text-align: center; border: 2px solid transparent; cursor: pointer; transition: 0.2s; }
        .selected-rf { border-color: var(--accent); background: rgba(0,122,255,0.1); }
        .selected-cn { border-color: #ff3b30; background: rgba(255,59,48,0.1); }

        .price-item { background: var(--card); padding: 12px 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #2c2c2e; margin-bottom: 8px; cursor: pointer; }
        .price-item.selected { border-color: var(--success); background: rgba(52,199,89,0.05); }
        .price-tag { color: var(--success); font-weight: bold; font-size: 16px; }

        input { width: 100%; background: var(--card); border: 1px solid #333; padding: 15px; border-radius: 12px; color: #fff; text-align: center; margin: 15px 0; box-sizing: border-box; outline: none; font-size: 16px; }
        .price-btn { width: 100%; background: var(--success); color: #fff; border: none; padding: 18px; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 16px; }
        .small-txt { color: #8e8e93; font-size: 11px; margin-top: 4px; display: block; }
    </style>
</head>
<body>

    <div id="screen-main" class="screen active">
        <h2>SPARK AUTO</h2>
        <div class="selector">
            <div id="card-rf" class="type-card selected-rf" onclick="setType('RF')">üá∑üá∫ –†–§</div>
            <div id="card-cn" class="type-card" onclick="setType('CN')">üá®üá≥ –ö–ò–¢–ê–ô</div>
        </div>

        <div id="prices-rf">
            <div class="price-item selected" onclick="setPrice(this, '99‚ÇΩ', 'Spark Base')">
                <div><b>Spark Base</b><span class="small-txt">–£–≥–æ–Ω, –∑–∞–ª–æ–≥–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</span></div>
                <div class="price-tag">99‚ÇΩ</div>
            </div>
            <div class="price-item" onclick="setPrice(this, '199‚ÇΩ', 'Spark Standard')">
                <div><b>Spark Standard</b><span class="small-txt">Base + –ü—Ä–æ–±–µ–≥–∏ –∏ –í–ª–∞–¥–µ–ª—å—Ü—ã</span></div>
                <div class="price-tag">199‚ÇΩ</div>
            </div>
            <div class="price-item" onclick="setPrice(this, '299‚ÇΩ', 'Spark Full')">
                <div><b>Spark Full</b><span class="small-txt">–î–¢–ü, –†–µ–º–æ–Ω—Ç—ã, –¢–∞–∫—Å–∏, –§–æ—Ç–æ</span></div>
                <div class="price-tag">299‚ÇΩ</div>
            </div>
        </div>

        <div id="prices-cn" style="display:none">
            <div class="price-item" onclick="setPrice(this, '490‚ÇΩ', 'China Lite')">
                <div><b>China Lite</b><span class="small-txt">–¢–µ—Ö-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –≠–∫—Å–ø–æ—Ä—Ç</span></div>
                <div class="price-tag">490‚ÇΩ</div>
            </div>
            <div class="price-item" onclick="setPrice(this, '1490‚ÇΩ', 'China Full')">
                <div><b>China Full</b><span class="small-txt">–ò—Å—Ç–æ—Ä–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –≤ –ö–ù–†</span></div>
                <div class="price-tag">1490‚ÇΩ</div>
            </div>
        </div>

        <input type="text" id="vin-input" placeholder="–í–í–ï–î–ò–¢–ï VIN">
        <label style="font-size: 12px; color: #8e8e93; display: block; text-align: center; margin-bottom: 15px;">
            <input type="checkbox" id="legal" checked> –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å –æ—Ñ–µ—Ä—Ç–æ–π
        </label>
    </div>

    <div id="screen-loading" class="screen" style="text-align:center;">
        <div style="margin-top:100px;">
            <div style="font-size: 20px; margin-bottom: 20px;">–ê–ù–ê–õ–ò–ó –î–ê–ù–ù–´–•...</div>
            <div style="color: #8e8e93;">–û–±—Ä–∞—â–∞–µ–º—Å—è –∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –±–∞–∑–∞–º...</div>
        </div>
    </div>

    <div id="screen-result" class="screen">
        <h2 style="color:var(--success)">–û–¢–ß–ï–¢ –ì–û–¢–û–í!</h2>
        <div style="background:var(--card); padding:20px; border-radius:12px; margin-bottom: 20px;">
            <p style="display:flex; justify-content:space-between; margin: 10px 0;">–û–±—ä–µ–∫—Ç: <b id="res-vin"></b></p>
            <p style="display:flex; justify-content:space-between; margin: 10px 0;">–¢–∞—Ä–∏—Ñ: <b id="res-tariff"></b></p>
            <p style="display:flex; justify-content:space-between; margin: 10px 0; color:var(--success)">–¶–µ–Ω–∞: <b id="res-price"></b></p>
        </div>
        <button class="price-btn" onclick="pay()">–û–ü–õ–ê–¢–ò–¢–¨ –ò –ü–û–õ–£–ß–ò–¢–¨</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        let curType = 'RF', curPrice = '99‚ÇΩ', curTariff = 'Spark Base';
        let makeUrl = "https://hook.eu1.make.com/deve7mhscs6nxy86x4dbxknph4e3jp4z";

        tg.MainButton.setText("–ó–ê–ü–£–°–¢–ò–¢–¨ –ü–†–û–í–ï–†–ö–£").show().onClick(() => {
            let vin = document.getElementById('vin-input').value;
            if(vin.length < 5) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π VIN");
            
            document.getElementById('res-vin').innerText = vin;
            document.getElementById('res-tariff').innerText = curTariff;
            document.getElementById('res-price').innerText = curPrice;
            
            show('screen-loading');
            
            fetch(makeUrl, { 
                method:'POST', 
                headers:{'Content-Type':'application/json'}, 
                body:JSON.stringify({
                    vin: vin, 
                    type: curType, 
                    price: curPrice, 
                    tariff: curTariff, 
                    user: tg.initDataUnsafe.user, 
                    status: 'search_started'
                }) 
            });
            
            setTimeout(() => show('screen-result'), 3500);
        });

        function setType(t) {
            curType = t;
            document.getElementById('card-rf').className = t=='RF'?'type-card selected-rf':'type-card';
            document.getElementById('card-cn').className = t=='CN'?'type-card selected-cn':'type-card';
            document.getElementById('prices-rf').style.display = t=='RF'?'block':'none';
            document.getElementById('prices-cn').style.display = t=='CN'?'block':'none';
            
            // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω—ã
            document.querySelectorAll('.price-item').forEach(i => i.classList.remove('selected'));
            if(t == 'RF') {
                curPrice = '99‚ÇΩ'; curTariff = 'Spark Base';
                document.querySelector('#prices-rf .price-item').classList.add('selected');
            } else {
                curPrice = '490‚ÇΩ'; curTariff = 'China Lite';
                document.querySelector('#prices-cn .price-item').classList.add('selected');
            }
        }

        function setPrice(el, p, n) {
            document.querySelectorAll('.price-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            curPrice = p; curTariff = n;
        }

        function show(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id != 'screen-main') tg.MainButton.hide();
        }

        function pay() {
            fetch(makeUrl, { 
                method:'POST', 
                headers:{'Content-Type':'application/json'}, 
                body:JSON.stringify({
                    vin: document.getElementById('res-vin').innerText, 
                    price: curPrice, 
                    tariff: curTariff,
                    user: tg.initDataUnsafe.user,
                    status: 'pay_clicked'
                }) 
            });
            tg.showAlert("–ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–ø–ª–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –±–æ—Ç!");
            setTimeout(() => tg.close(), 2000);
        }
    </script>
</body>
</html>
