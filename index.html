<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spark Auto Check</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0c0c0e; --card: #1c1c1e; --accent: #007aff; --accent-cn: #ff3b30;
            --text: #ffffff; --text-dim: #8e8e93; --success: #34c759;
        }
        body { background-color: var(--bg); color: var(--text); font-family: -apple-system, system-ui, sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; overflow-x: hidden; }
        .screen { display: none; width: 100%; max-width: 360px; animation: fadeIn 0.3s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        h2 { font-size: 20px; text-align: center; margin-bottom: 5px; font-weight: 800; }
        .subtitle { color: var(--text-dim); font-size: 11px; text-align: center; margin-bottom: 25px; letter-spacing: 1px; }

        .selector { display: flex; gap: 10px; margin-bottom: 20px; }
        .type-card { flex: 1; background: var(--card); padding: 15px 10px; border-radius: 16px; text-align: center; border: 2px solid transparent; cursor: pointer; }
        .type-card.selected-rf { border-color: var(--accent); background: rgba(0,122,255,0.1); }
        .type-card.selected-cn { border-color: var(--accent-cn); background: rgba(255,59,48,0.1); }
        .base-list { font-size: 9px; color: #555; margin-top: 8px; line-height: 1.2; text-transform: uppercase; }

        /* –¢–∞—Ä–∏—Ñ—ã */
        .price-grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 15px; }
        .price-item { background: var(--card); padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #2c2c2e; cursor: pointer; }
        .price-item.selected { border-color: var(--success); background: rgba(52,199,89,0.05); }
        .price-info b { display: block; font-size: 14px; }
        .price-info span { font-size: 11px; color: var(--text-dim); }
        .price-tag { color: var(--success); font-weight: 700; font-size: 15px; }

        .input-box { width: 100%; background: var(--card); border-radius: 14px; padding: 15px; margin: 15px 0; box-sizing: border-box; border: 1px solid #333; font-size: 18px; color: white; text-align: center; text-transform: uppercase; }
        .agreement { display: flex; align-items: flex-start; gap: 10px; margin: 15px 0; font-size: 11px; color: var(--text-dim); }
        .agreement b { color: var(--accent); text-decoration: underline; cursor: pointer; }
        
        .loader { width: 50px; height: 50px; border: 4px solid #333; border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin: 40px auto 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .status-line { font-size: 13px; color: var(--text-dim); margin: 8px 0; text-align: center; }

        .price-btn { width: 100%; background: var(--success); color: white; border: none; padding: 18px; border-radius: 16px; font-weight: 700; font-size: 16px; margin-top: 20px; cursor: pointer; }
        #legal-text { font-size: 13px; color: var(--text-dim); line-height: 1.5; height: 300px; overflow-y: scroll; padding: 15px; background: #111; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="screen-main" class="screen active">
        <h2>SPARK AUTO CHECK</h2>
        <div class="subtitle">–ü–†–û–í–ï–†–ö–ê –ò–°–¢–û–†–ò–ò –ê–í–¢–û–ú–û–ë–ò–õ–Ø</div>

        <div class="selector">
            <div id="card-rf" class="type-card selected-rf" onclick="setType('RF')">
                <span style="font-size: 24px;">üá∑üá∫</span><br><b>–†–§ –ò –°–ù–ì</b>
                <div class="base-list">–ì–ò–ë–î–î ‚Ä¢ –§–ù–ü ‚Ä¢ –†–°–ê ‚Ä¢ –§–°–°–ü</div>
            </div>
            <div id="card-cn" class="type-card" onclick="setType('CN')">
                <span style="font-size: 24px;">üá®üá≥</span><br><b>–ö–ò–¢–ê–ô</b>
                <div class="base-list">C-ASAM ‚Ä¢ CBX ‚Ä¢ –≠–ö–°–ü–û–†–¢</div>
            </div>
        </div>

        <div id="prices-rf" class="price-grid">
            <div class="price-item selected" onclick="selectPrice(this, '399‚ÇΩ')">
                <div class="price-info"><b>1 –û–¢–ß–ï–¢</b><span>–ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ VIN</span></div>
                <div class="price-tag">399‚ÇΩ</div>
            </div>
            <div class="price-item" onclick="selectPrice(this, '1490‚ÇΩ')">
                <div class="price-info"><b>–ü–ê–ö–ï–¢ "5 –û–¢–ß–ï–¢–û–í"</b><span>–í—ã–≥–æ–¥–∞ 25%</span></div>
                <div class="price-tag">1490‚ÇΩ</div>
            </div>
        </div>

        <div id="prices-cn" class="price-grid" style="display:none">
            <div class="price-item selected" onclick="selectPrice(this, '990‚ÇΩ')">
                <div class="price-info"><b>–≠–ö–°–ü–†–ï–°–° –ö–ò–¢–ê–ô</b><span>–¢–µ—Ö. –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç</span></div>
                <div class="price-tag">990‚ÇΩ</div>
            </div>
            <div class="price-item" onclick="selectPrice(this, '2490‚ÇΩ')">
                <div class="price-info"><b>–ü–û–õ–ù–´–ô –ò–°–¢–û–†–ò–Ø</b><span>–ò—Å—Ç–æ—Ä–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –≤ –ö–ù–†</span></div>
                <div class="price-tag">2490‚ÇΩ</div>
            </div>
        </div>

        <input type="text" id="vin-input" class="input-box" placeholder="–í–í–ï–î–ò–¢–ï VIN / –ù–û–ú–ï–†">
        
        <div class="agreement">
            <input type="checkbox" id="check-legal">
            <span>–Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å <b onclick="showScreen('screen-legal')">–ø—É–±–ª–∏—á–Ω–æ–π –æ—Ñ–µ—Ä—Ç–æ–π</b></span>
        </div>
    </div>

    <div id="screen-legal" class="screen">
        <h2>–ü–£–ë–õ–ò–ß–ù–ê–Ø –û–§–ï–†–¢–ê</h2>
        <div id="legal-text">
            <p>–ù–∞—Å—Ç–æ—è—â–∞—è –æ—Ñ–µ—Ä—Ç–∞ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ –æ–± –∏—Å—Ç–æ—Ä–∏–∏ –¢–°...</p>
            <p>–û–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤–∞—à–µ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Å–µ—Ä–≤–∏—Å–∞ Spark Auto Check.</p>
        </div>
        <button class="price-btn" style="background: var(--accent);" onclick="showScreen('screen-main')">–í–ï–†–ù–£–¢–¨–°–Ø</button>
    </div>

    <div id="screen-loading" class="screen">
        <div class="loader"></div>
        <h2 id="load-title">–ê–ù–ê–õ–ò–ó –î–ê–ù–ù–´–•</h2>
        <div class="status-line" id="s1">‚óè –î–æ—Å—Ç—É–ø –∫ —à–ª—é–∑—É –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö...</div>
        <div class="status-line" id="s2" style="opacity:0">‚óè –ü—Ä–æ–≤–µ—Ä–∫–∞ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π —á–∏—Å—Ç–æ—Ç—ã...</div>
        <div class="status-line" id="s3" style="opacity:0">‚óè –ü–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏...</div>
    </div>

    <div id="screen-result" class="screen">
        <h2 style="color: var(--success);">–û–¢–ß–ï–¢ –ì–û–¢–û–í!</h2>
        <div style="background:var(--card); padding:20px; border-radius:16px; margin-top:10px">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px"><span>–û–±—ä–µ–∫—Ç:</span><b id="res-vin">-</b></div>
            <div style="display:flex; justify-content:space-between; color:var(--success)"><span>–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞—Ä–∏—Ñ:</span><b id="res-price">399‚ÇΩ</b></div>
        </div>
        <button class="price-btn" onclick="startPay()">–û–ü–õ–ê–¢–ò–¢–¨ –ò –ü–û–õ–£–ß–ò–¢–¨</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        let currentType = 'RF';
        let currentPrice = '399‚ÇΩ';
        const makeUrl = "https://hook.eu1.make.com/deve7mhscs6nxy86x4dbxknph4e3jp4z";

        tg.MainButton.setText("–ó–ê–ü–£–°–¢–ò–¢–¨ –ü–†–û–í–ï–†–ö–£").show();

        function setType(type) {
            currentType = type;
            document.getElementById('card-rf').className = type === 'RF' ? 'type-card selected-rf' : 'type-card';
            document.getElementById('card-cn').className = type === 'CN' ? 'type-card selected-cn' : 'type-card';
            document.getElementById('prices-rf').style.display = type === 'RF' ? 'grid' : 'none';
            document.getElementById('prices-cn').style.display = type === 'CN' ? 'grid' : 'none';
            
            // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞ —Ü–µ–Ω—ã –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω—ã
            currentPrice = type === 'RF' ? '399‚ÇΩ' : '990‚ÇΩ';
            document.querySelectorAll('.price-item').forEach(el => el.classList.remove('selected'));
            document.querySelector(type === 'RF' ? '#prices-rf .price-item' : '#prices-cn .price-item').classList.add('selected');
            
            tg.MainButton.setParams({color: type === 'RF' ? '#007aff' : '#ff3b30'});
        }

        function selectPrice(el, price) {
            document.querySelectorAll('.price-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            currentPrice = price;
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'screen-main') tg.MainButton.show(); else tg.MainButton.hide();
        }

        tg.MainButton.onClick(function() {
            const vin = document.getElementById('vin-input').value;
            if(!document.getElementById('check-legal').checked) return tg.showAlert("–ü—Ä–∏–º–∏—Ç–µ –æ—Ñ–µ—Ä—Ç—É!");
            if(vin.length < 5) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ VIN!");

            document.getElementById('res-vin').innerText = vin;
            document.getElementById('res-price').innerText = currentPrice;
            showScreen('screen-loading');

            setTimeout(() => { document.getElementById('s2').style.opacity = 1; }, 1500);
            setTimeout(() => { document.getElementById('s3').style.opacity = 1; }, 3000);
            setTimeout(() => { showScreen('screen-result'); }, 4500);

            fetch(makeUrl, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ vin: vin, type: currentType, price: currentPrice, user: tg.initDataUnsafe.user, status: 'search_started' })
            });
        });

        function startPay() {
            fetch(makeUrl, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ vin: document.getElementById('res-vin').innerText, price: currentPrice, user: tg.initDataUnsafe.user, status: 'pay_clicked' })
            });
            tg.showAlert("–ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–ø–ª–∞—Ç—É " + currentPrice + " –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
            setTimeout(() => { tg.close(); }, 2000);
        }
    </script>
</body>
</html>
