<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spark Auto Check</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0c0c0e;
            --card: #1c1c1e;
            --accent: #007aff;
            --accent-cn: #ff3b30;
            --text: #ffffff;
            --text-dim: #8e8e93;
            --success: #34c759;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
        }

        .screen { display: none; width: 100%; max-width: 360px; animation: fadeIn 0.3s ease; }
        .active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h2 { font-size: 20px; text-align: center; margin-bottom: 5px; font-weight: 800; }
        .subtitle { color: var(--text-dim); font-size: 11px; text-align: center; margin-bottom: 25px; letter-spacing: 1px; }

        .selector { display: flex; gap: 10px; margin-bottom: 20px; }
        .type-card {
            flex: 1; background: var(--card); padding: 15px; border-radius: 16px;
            text-align: center; border: 2px solid transparent; transition: 0.2s; cursor: pointer;
        }
        .type-card.selected-rf { border-color: var(--accent); background: rgba(0,122,255,0.1); }
        .type-card.selected-cn { border-color: var(--accent-cn); background: rgba(255,59,48,0.1); }

        .input-box {
            width: 100%; background: var(--card); border-radius: 14px;
            padding: 15px; margin-bottom: 15px; box-sizing: border-box;
            border: 1px solid #333; font-size: 18px; color: white; text-align: center; text-transform: uppercase;
        }

        .agreement { display: flex; align-items: flex-start; gap: 10px; margin: 15px 0; font-size: 12px; color: var(--text-dim); }
        .agreement b { color: var(--accent); text-decoration: underline; cursor: pointer; }
        input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--accent); }

        .loader {
            width: 50px; height: 50px; border: 4px solid #333; border-top-color: var(--accent);
            border-radius: 50%; animation: spin 1s linear infinite; margin: 40px auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .status-line { font-size: 13px; color: var(--text-dim); margin: 8px 0; text-align: center; }

        .res-card { background: var(--card); border-radius: 16px; padding: 20px; margin-top: 10px; }
        .res-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #2c2c2e; font-size: 14px; }
        .res-row:last-child { border: none; }
        
        .price-btn {
            width: 100%; background: var(--success); color: white; border: none;
            padding: 18px; border-radius: 16px; font-weight: 700; font-size: 16px; margin-top: 20px; cursor: pointer;
        }

        #legal-text { font-size: 13px; color: var(--text-dim); line-height: 1.5; height: 300px; overflow-y: scroll; padding: 10px; background: #111; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="screen-main" class="screen active">
        <h2>SPARK AUTO CHECK</h2>
        <div class="subtitle">–ü–†–û–í–ï–†–ö–ê –ò–°–¢–û–†–ò–ò –ê–í–¢–û–ú–û–ë–ò–õ–Ø</div>

        <div class="selector">
            <div id="card-rf" class="type-card selected-rf" onclick="setType('RF')">
                <span style="font-size: 24px;">üá∑üá∫</span><br><b>–†–§ / –°–ù–ì</b>
            </div>
            <div id="card-cn" class="type-card" onclick="setType('CN')">
                <span style="font-size: 24px;">üá®üá≥</span><br><b>–ö–ò–¢–ê–ô</b>
            </div>
        </div>

        <input type="text" id="vin-input" class="input-box" placeholder="–í–í–ï–î–ò–¢–ï VIN / –ù–û–ú–ï–†">
        
        <div class="agreement">
            <input type="checkbox" id="check-legal">
            <span>–Ø –ø—Ä–æ—á–∏—Ç–∞–ª –∏ —Å–æ–≥–ª–∞—Å–µ–Ω —Å <b onclick="showScreen('screen-legal')">–ø—É–±–ª–∏—á–Ω–æ–π –æ—Ñ–µ—Ä—Ç–æ–π</b></span>
        </div>
    </div>

    <div id="screen-legal" class="screen">
        <h2>–ü–£–ë–õ–ò–ß–ù–ê–Ø –û–§–ï–†–¢–ê</h2>
        <div id="legal-text">
            <p>1. –û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è: –°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç—á–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –ì–ò–ë–î–î –∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.</p>
            <p>2. –û–ø–ª–∞—Ç–∞: –£—Å–ª—É–≥–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ–∫–∞–∑–∞–Ω–Ω–æ–π –≤ –º–æ–º–µ–Ω—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ç—á–µ—Ç.</p>
            <p>3. –í–æ–∑–≤—Ä–∞—Ç: –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω –ø–æ—Å–ª–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞.</p>
            <p>4. –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å: –ú—ã –Ω–µ —Ö—Ä–∞–Ω–∏–º –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.</p>
        </div>
        <button class="price-btn" style="background: var(--accent);" onclick="showScreen('screen-main')">–ü–†–ò–ù–Ø–¢–¨ –ò –í–ï–†–ù–£–¢–¨–°–Ø</button>
    </div>

    <div id="screen-loading" class="screen">
        <div class="loader"></div>
        <h2 id="load-title">–ê–ù–ê–õ–ò–ó –î–ê–ù–ù–´–•</h2>
        <div class="status-line" id="s1">‚óè –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–∞–º –ì–ò–ë–î–î...</div>
        <div class="status-line" id="s2" style="opacity:0">‚óè –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–ª–æ–≥–∏ –∏ —Ä–æ–∑—ã—Å–∫...</div>
        <div class="status-line" id="s3" style="opacity:0">‚óè –ü–æ–∏—Å–∫ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–±–µ–≥–æ–≤...</div>
    </div>

    <div id="screen-result" class="screen">
        <h2 style="color: var(--success);">–î–ê–ù–ù–´–ï –ù–ê–ô–î–ï–ù–´!</h2>
        <div class="res-card">
            <div class="res-row"><span>–û–±—ä–µ–∫—Ç:</span><b id="res-vin">-</b></div>
            <div class="res-row"><span>–ò—Å—Ç–æ—Ä–∏—è –î–¢–ü:</span><b>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</b></div>
            <div class="res-row"><span>–ó–∞–ª–æ–≥–∏:</span><b>–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</b></div>
            <div class="res-row"><span>–ü—Ä–æ–±–µ–≥–∏:</span><b>–ù–∞–π–¥–µ–Ω–æ 3+ –∑–∞–ø–∏—Å–∏</b></div>
        </div>
        <button class="price-btn" onclick="startPay()">–û–ü–õ–ê–¢–ò–¢–¨ –û–¢–ß–ï–¢ ‚Äî 399‚ÇΩ</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        let currentType = 'RF';
        const makeUrl = "https://hook.eu1.make.com/deve7mhscs6nxy86x4dbxknph4e3jp4z";

        tg.MainButton.setText("–ó–ê–ü–£–°–¢–ò–¢–¨ –ü–†–û–í–ï–†–ö–£").show();

        function setType(type) {
            currentType = type;
            document.getElementById('card-rf').className = type === 'RF' ? 'type-card selected-rf' : 'type-card';
            document.getElementById('card-cn').className = type === 'CN' ? 'type-card selected-cn' : 'type-card';
            tg.MainButton.setParams({color: type === 'RF' ? '#007aff' : '#ff3b30'});
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'screen-main') tg.MainButton.show(); else tg.MainButton.hide();
        }

        tg.MainButton.onClick(function() {
            const vin = document.getElementById('vin-input').value;
            const agree = document.getElementById('check-legal').checked;

            if(!agree) return tg.showAlert("–ü—Ä–∏–º–∏—Ç–µ —É—Å–ª–æ–≤–∏—è –æ—Ñ–µ—Ä—Ç—ã!");
            if(vin.length < 5) return tg.showAlert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π VIN!");

            document.getElementById('res-vin').innerText = vin;
            showScreen('screen-loading');

            setTimeout(() => { document.getElementById('s2').style.opacity = 1; }, 1500);
            setTimeout(() => { document.getElementById('s3').style.opacity = 1; }, 3000);
            setTimeout(() => { showScreen('screen-result'); }, 4500);

            // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Make
            fetch(makeUrl, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    vin: vin, 
                    type: currentType, 
                    user: tg.initDataUnsafe.user,
                    action: 'search_started'
                })
            });
        });

        function startPay() {
            // –°–∏–≥–Ω–∞–ª –≤ Make, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –Ω–∞–∂–∞–ª "–û–ø–ª–∞—Ç–∏—Ç—å"
            fetch(makeUrl, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    vin: document.getElementById('res-vin').innerText,
                    user: tg.initDataUnsafe.user,
                    action: 'pay_clicked'
                })
            });
            tg.showAlert("–ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–ø–ª–∞—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –±–æ—Ç–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.");
            setTimeout(() => { tg.close(); }, 2000);
        }
    </script>
</body>
</html>
