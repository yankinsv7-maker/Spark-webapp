<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spark Auto Check</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0c0c0e; --card: #1c1c1e; --accent: #007aff; --accent-cn: #ff3b30;
            --text: #ffffff; --text-dim: #8e8e93; --success: #34c759;
        }
        body { background-color: var(--bg); color: var(--text); font-family: -apple-system, system-ui, sans-serif; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        .screen { display: none; width: 100%; max-width: 400px; }
        .active { display: block !important; }
        
        h2 { font-size: 22px; text-align: center; margin: 10px 0 5px 0; font-weight: 800; }
        .subtitle { color: var(--text-dim); font-size: 10px; text-align: center; margin-bottom: 20px; letter-spacing: 1px; text-transform: uppercase; }

        .selector { display: flex; gap: 10px; margin-bottom: 15px; width: 100%; }
        .type-card { flex: 1; background: var(--card); padding: 12px; border-radius: 12px; text-align: center; border: 2px solid transparent; cursor: pointer; transition: 0.2s; }
        .type-card.selected-rf { border-color: var(--accent); background: rgba(0,122,255,0.15); }
        .type-card.selected-cn { border-color: var(--accent-cn); background: rgba(255,59,48,0.15); }
        .base-list { font-size: 8px; color: #666; margin-top: 5px; line-height: 1.1; }

        .price-grid { display: block; width: 100%; margin-top: 10px; }
        .price-item { background: var(--card); padding: 12px 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #2c2c2e; margin-bottom: 8px; cursor: pointer; }
        .price-item.selected { border-color: var(--success); background: rgba(52,199,89,0.1); }
        .price-info b { display: block; font-size: 14px; margin-bottom: 2px; }
        .price-info span { font-size: 11px; color: var(--text-dim); }
        .price-tag { color: var(--success); font-weight: 700; font-size: 16px; }

        .input-box { width: 100%; background: var(--card); border-radius: 12px; padding: 15px; margin: 15px 0; box-sizing: border-box; border: 1px solid #333; font-size: 16px; color: white; text-align: center; outline: none; }
        .agreement { display: flex; align-items: center; gap: 8px; margin-bottom: 20px; font-size: 11px; color: var(--text-dim); width: 100%; }
        .agreement b { color: var(--accent); text-decoration: underline; }
        
        .loader { width: 40px; height: 40px; border: 3px solid #333; border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin: 50px auto 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .status-line { font-size: 13px; color: var(--text-dim); margin: 10px 0; text-align: center; }

        .price-btn { width: 100%; background: var(--success); color: white; border: none; padding: 16px; border-radius: 12px; font-weight: 700; font-size: 16px; margin-top: 10px; cursor: pointer; }
        #legal-text { font-size: 12px; color: #ccc; line-height: 1.4; height: 300px; overflow-y: auto; padding: 10px; background: #000; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="screen-main" class="screen active">
        <h2>SPARK AUTO</h2>
        <div class="subtitle">–ü–†–û–í–ï–†–ö–ê –ü–û –í–°–ï–ú –ë–ê–ó–ê–ú –†–§ –ò –ö–ò–¢–ê–Ø</div>

        <div class="selector">
            <div id="card-rf" class="type-card selected-rf" onclick="setType('RF')">
                <span style="font-size: 20px;">üá∑üá∫ –†–§</span><br>
                <div class="base-list">–ì–ò–ë–î–î ‚Ä¢ –§–ù–ü ‚Ä¢ –†–°–ê</div>
            </div>
            <div id="card-cn" class="type-card" onclick="setType('CN')">
                <span style="font-size: 20px;">üá®üá≥ –ö–ò–¢–ê–ô</span><br>
                <div class="base-list">C-ASAM ‚Ä¢ CBX ‚Ä¢ –≠–ö–°–ü–û–†–¢</div>
            </div>
        </div>

        <div id="prices-rf" class="price-grid">
            <div class="price-item selected" onclick="selectPrice(this, '199‚ÇΩ', '–ö—Ä–∞—Ç–∫–∏–π –æ—Ç—á–µ—Ç')">
                <div class="price-info"><b>–ö—Ä–∞—Ç–∫–∏–π –æ—Ç—á–µ—Ç</b><span>–£–≥–æ–Ω –∏ –∑–∞–ª–æ–≥–∏</span></div>
                <div class="price-tag">199‚ÇΩ</div>
            </div>
            <div class="price-item" onclick="selectPrice(this, '399‚ÇΩ', '–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è')">
                <div class="price-info"><b>–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è</b><span>–î–¢–ü, –ø—Ä–æ–±–µ–≥–∏, —Ç–∞–∫—Å–∏</span></div>
                <div class="price-tag">399‚ÇΩ</div>
            </div>
        </div>

        <div id="prices-cn" class="price-grid" style="display:none">
            <div class="price-item selected" onclick="selectPrice(this, '990‚ÇΩ', '–¢–µ—Ö-–ª–∏—Å—Ç –ö–ù–†')">
                <div class="price-info"><b>–¢–µ—Ö-–ª–∏—Å—Ç –ö–ù–†</b><span>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –≤—ã–≤–æ–∑</span></div>
                <div class="price-tag">990‚ÇΩ</div>
            </div>
            <div class="price-item" onclick="selectPrice(this, '2490‚ÇΩ', '–ò—Å—Ç–æ—Ä–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è')">
                <div class="price-info"><b>–ò—Å—Ç–æ—Ä–∏—è –≤ –ö–ù–†</b><span>–†–µ–º–æ–Ω—Ç—ã –∏ –¥–∏–ª–µ—Ä—ã</span></div>
                <div class="price-tag">2490‚ÇΩ</div>
            </div>
        </div>

        <input type="text" id="vin-input" class="input-box" placeholder="–í–í–ï–î–ò–¢–ï VIN">
        
        <div class="agreement">
            <input type="checkbox" id="check-legal" checked>
            <span>–Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å <b onclick="showScreen('screen-legal')">–ø—Ä–∞–≤–∏–ª–∞–º–∏ —Å–µ—Ä–≤–∏—Å–∞</b></span>
        </div>
    </div>

    <div id="screen-legal" class="screen">
        <h2>–ü–†–ê–í–ò–õ–ê</h2>
        <div id="legal-text">
            <p>–°–µ—Ä–≤–∏—Å Spark Auto –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –†–§ –∏ –ö–ù–†.</p>
            <p>–û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –∑–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞.</p>
        </div>
        <button class="price-btn" style="background: var(--accent);" onclick="showScreen('screen-main')">–ù–ê–ó–ê–î</button>
    </div>

    <div id="screen-loading" class="screen">
        <div class="loader"></div>
        <h2 id="load-title">–ê–ù–ê–õ–ò–ó –î–ê–ù–ù–´–•</h2>
        <div class="status-line" id="s1">‚óè –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —à–ª—é–∑—É...</div>
        <div class="status-line" id="s2" style="opacity:0.3">‚óè –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π...</div>
    </div>

    <div id="screen-result" class="screen">
        <h2 style="color: var(--success);">–ì–û–¢–û–í–û!</h2>
        <div style="background:var(--card); padding:20px; border-radius:12px; margin: 15px 0;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px"><span>VIN:</span><b id="res-vin">-</b></div>
            <div style="display:flex; justify-content:space-between; color:var(--success)"><span>–ö –æ–ø–ª–∞—Ç–µ:</span><b id="res-price">199‚ÇΩ</b></div>
        </div>
        <button class="price-btn" onclick="startPay()">–û–ü–õ–ê–¢–ò–¢–¨ –û–¢–ß–ï–¢</button>
    </div>

    <script>
        var tg = window.Telegram.WebApp;
        tg.expand();
        var currentType = 'RF';
        var currentPrice = '199‚ÇΩ';
        var currentTariff = '–ö—Ä–∞—Ç–∫–∏–π –æ—Ç—á–µ—Ç';
        var makeUrl = "https://hook.eu1.make.com/deve7mhscs6nxy86x4dbxknph4e3jp4z";

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¢–ì —Å—Ä–∞–∑—É
        tg.MainButton.setText("–ó–ê–ü–£–°–¢–ò–¢–¨ –ü–†–û–í–ï–†–ö–£").show();

        function setType(type) {
            currentType = type;
            document.getElementById('card-rf').className = (type === 'RF') ? 'type-card selected-rf' : 'type-card';
            document.getElementById('card-cn').className = (type === 'CN') ? 'type-card selected-cn' : 'type-card';
            document.getElementById('prices-rf').style.display = (type === 'RF') ? 'block' : 'none';
            document.getElementById('prices-cn').style.display = (type === 'CN') ? 'block' : 'none';
            
            if(type === 'RF') {
                currentPrice = '199‚ÇΩ'; currentTariff = '–ö—Ä–∞—Ç–∫–∏–π –æ—Ç—á–µ—Ç';
            } else {
                currentPrice = '990‚ÇΩ'; currentTariff = '–¢–µ—Ö-–ª–∏—Å—Ç –ö–ù–†';
            }
            tg.MainButton.setParams({color: (type === 'RF' ? '#007aff' : '#ff3b30')});
        }

        function selectPrice(el, price, name) {
            var items = document.querySelectorAll('.price-item');
            for(var i=0; i<items.length; i++) items[i].classList.remove('selected');
            el.classList.add('selected');
            currentPrice = price;
            currentTariff = name;
        }

        function showScreen(id) {
            var screens = document.querySelectorAll('.screen');
            for(var i=0; i<screens.length; i++) screens[i].classList.remove('active');
            document.getElementById(id).classList.add('active');
            if(id === 'screen-main') tg.MainButton.show(); else tg.MainButton.hide();
        }

        tg.MainButton.onClick(function() {
            var vin = document.getElementById('vin-input').value;
            if(!document.getElementById('check-legal').checked) {
                tg.showAlert("–ü—Ä–∏–º–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞!");
                return;
            }
            if(vin.length < 5) {
                tg.showAlert("–í–≤–µ–¥–∏—Ç–µ VIN!");
                return;
            }

            document.getElementById('res-vin').innerText = vin;
            document.getElementById('res-price').innerText = currentPrice;
            showScreen('screen-loading');

            setTimeout(function(){ document.getElementById('s2').style.opacity = 1; }, 2000);
            setTimeout(function(){ showScreen('screen-result'); }, 4000);

            fetch(makeUrl, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    vin: vin, 
                    type: currentType, 
                    price: currentPrice, 
                    tariff: currentTariff,
                    user: tg.initDataUnsafe.user, 
                    status: 'search_started' 
                })
            });
        });

        function startPay() {
            fetch(makeUrl, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    vin: document.getElementById('res-vin').innerText, 
                    price: currentPrice, 
                    tariff: currentTariff,
                    user: tg.initDataUnsafe.user, 
                    status: 'pay_clicked' 
                })
            });
            tg.showAlert("–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ë–æ—Ç –ø—Ä–∏—à–ª–µ—Ç —Å—á–µ—Ç –≤ —á–∞—Ç.");
            setTimeout(function(){ tg.close(); }, 2000);
        }
    </script>
</body>
</html>
